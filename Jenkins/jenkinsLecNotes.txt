##################################
â„ï¸ Build and deployement process 
##################################
âž¤ Source code is taken from git hub (git clone)
âž¤ Compilation unit testing and package code as .jar file mvn clean test package 
âž¤ Create docker image 
âž¤ Run the docker image inside the container 

ðŸ‘‰ There are different different servers in our company prod , QA , Testing Like this so we have to do all of the above for all of these servers this would take a lot of time to do all this manually so we will use jenkins to automate this deployement process.

############
â„ï¸ Jenkins 
############
âž¤ The whole purpose of jenkins is to automate the deployment process .
âž¤ Jenkins is a popular open source automation server used for continous integration(CI) and Continous Deployment (CD) in software development . It helps automate the building ,testing ,and deployment of  applications 
âž¤ Automation - Jenkins automates repetitive tasks like code compilation testing and deployment 
âž¤ Plugins - It has 1800+ plugins ,integrating with git ,Docker ,Kubernetes, Maven and more 
âž¤ Pipeline as code - Uses jenkinsfile(Written in groovy) to define CI/CD pipelines

ðŸŒŸ Jenkins CI/CD flow 
***********************
âž¤ Developer push code to a repository (Github ,gitlab, bitbucket)
âž¤ Jenkins pulls the latest code and triggers a build using maven 
âž¤ Artifact is generated(Eg: jar, docker image).
âž¤ Deployment - Jenkins deploys the application to a test/staging/production environment 
âž¤ We can create jenkins pipeline in 2 ways: 
1ï¸âƒ£ Declarative pipeline 
2ï¸âƒ£ Scripted pipeline (Groovy) 

âœ¨ Jenkins Declarative pipeline 
================================
âž¤ A jenkins declarative pipeline is a structured way to define a CI/CD pipeline using groovy-based syntax. Lets break down your pipeline step by step: 

ðŸŒ¬ï¸ Pipeline Structure 
-----------------------
pipeline {  
    agent any  // Runs the pipeline on any available agent (Jenkins node)

    stages {  // Defines different stages of the pipeline
        stage('git clone') {  // Stage 1: Clone the repository
            steps {  
                // Logic for cloning a Git repository
            }
        }
        stage('mvn build') {  // Stage 2: Build the project using Maven
            steps {  
                // Logic for running Maven build
            }
        }
        stage('build image') {  // Stage 3: Build a Docker image
            steps {  
                // Logic for building a Docker image
            }
        }
    }
}

ðŸ‘‰ We are gonna run the commands in the shell so for that we will write sh in front of every command that we write inside this  jenkinsfile .

âž¤ Note: The sh command in a Jenkins Declarative Pipeline is used to execute shell (bash)

âœ… Explanation of Each Section
................................
1. pipeline {}
This is the root block that defines the entire CI/CD pipeline.

2. agent any
Specifies that the pipeline can run on any available Jenkins node (agent).

If you want to run it on a specific node, you can use:

groovy

agent { label 'my-node' }
3. stages {}
A stage represents a logical step in the pipeline.

Each stage contains steps {} where the actual actions are performed.

#####################################
â„ï¸ Jenkins Server setup in Linux VM 
#####################################
âž¤ Jenkins is build using java so even before installing jenkins we have to install jdk on our server . 

ðŸ‘‰ Step - 1 : Create Linux VM in AWS
*************************************
âž¤ Create Ubuntu VM using AWS EC2 (t2.medium, because jenkins require minimum 4gb RAM)

Note: Enable 8080 Port Number in Security Group Inbound Rules

ðŸ‘‰ Step-2 : Install Java using below commands
***********************************************
sudo apt update
sudo apt install fontconfig openjdk-17-jre
java -version

ðŸ‘‰ Step-3 : To Install Jenkins use the below commands
*******************************************************
sudo wget -O /usr/share/keyrings/jenkins-keyring.asc \
  https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key
echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \
  https://pkg.jenkins.io/debian-stable binary/ | sudo tee \
  /etc/apt/sources.list.d/jenkins.list > /dev/null
sudo apt-get update
sudo apt-get install jenkins

ðŸ‘‰ Step-4 : Start Jenkins services using below commands
********************************************************
sudo systemctl enable jenkins
sudo systemctl start jenkins

ðŸ‘‰ Step-5 : Verify Jenkins setup
**********************************
sudo systemctl status jenkins

ðŸ‘‰ Step-6 : Open jenkins server in browser using VM public ip of linux vm
*************************************************************************
http://public-ip:8080/

ðŸ‘‰ Step-7 : Copy jenkins admin pwd
************************************
sudo cat /var/lib/jenkins/secrets/initialAdminPassword

ðŸ‘‰ Step-8 : Create Admin Account & Install Required Plugins in Jenkins

âž¤ Now click on create job --> give the name --> select pipeline and click ok.
âž¤ After that we will reach the next page where it will ask for description if we scroll down we can see pipeline script section this is where we are gonna write our script.
âž¤ Click on apply and save . Pipeline is created now if you go to this pipeline and click on configuration there we can see the pipeline script section so here we will write our script  .
pipeline {
    agent any

    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }
    }
}
âž¤ After writing script click on apply and save and then select the build now option it will start to create a build and will run our script so now go to console output you can see the output as hello world because we have written the script to print hello world 
âž¤ Now if we go to configure section there we can find an option build periodically this will run our script after the time intervals you select if you select 5min then for every 5 min this script will run.
***** // This means run every min.

âž¤ We can also use the option of poll scm(source code management tool) present in the configure section that will run our script only when there is some change in our code.

âž¤ Go to manage jenkins section in the settings and there click on tools then add maven as we need maven to make jar files for us so we will add maven to our jenkins 

#########################################################
â„ï¸ How can we automate the build and deployment process 
#########################################################
âž¤ Download docker in your vm 
curl -fsSL get.docker.com | /bin/bash
sudo usermod -aG docker jenkins
sudo usermod -aG docker ubuntu
sudo systemctl restart jenkins
sudo docker version

âž¤ Add this script in the jenkins 
pipeline {
    agent any
    
    tools {
        maven 'x-3.9.9'  
    }

    stages {
        stage('git clone') {
            steps {
                git branch: 'main', url: 'https://github.com/pankajmutha14/docker-test.git'
            }
        }
        stage('mvn') {
            steps{
                sh 'mvn clean test package'
            }
        }
         stage('build image') {
            steps{
                sh 'docker build -t psait/test1 .'
            }
        }
        stage('deployment'){
            steps{
                sh 'docker stop psait'
                sh 'docker rm psait'
                sh 'docker run -d -p 9090:8080 --name psait/test1'
            }
        }
    }
}

âž¤ Now suppose we want to run our this script every min then we will go to configure --> trigger --> build periodically --> ***** (for printing every min add this )
âž¤ We should run the script everytime the changes is seen in our github this is the good practice so for that we will select poll scm option in the triggers there give *****
âž¤ Now every one min it will check the github is the code updated if it is updated then it will run the script again else it will not run the script.
âž¤ Since our container is already running so if next time again we try to run it this will give us a problem so first we will stop the container then run again so for this we have added this commands in the deployment stage steps 
sh 'docker stop psait'
sh 'docker rm psait'

