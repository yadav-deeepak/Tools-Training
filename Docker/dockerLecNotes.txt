#####################
‚ùÑÔ∏è What is Docker ?
####################
‚û§ Docker will make our application compatible to run on different platforms.
‚û§ Docker will make our application portable we can run our application on any server and it will run for sure.
‚û§ Resolves compatibility problem using containerization 
‚û§ Docker will help us to install our software on different server without worrying about compatibility issue
‚û§ To deploy same application on multiple servers for load balancing we need not manually install technology stack (like Angular 18v, java 17V etc) manually one by one if docker is not used
‚û§ Software updates can be done easily on multiple machines using docker

üëâ Note:
‚úî Docker Engine acts as a bridge between the container and the host OS
‚úî Containers don‚Äôt have their own kernel, they use the host‚Äôs kernel
‚úî Docker Engine manages containers but does not create them‚Äîit runs & controls them

‚û§ We will create a linux VM and install linux OS in it on top of linux OS we will also install Docker Engine in it.
‚û§ Our application will run in an isolated environment inside the linux vm this isolated environment is called as docker container.
‚û§ Docker engine will act as a bridge that will help us to run docker container inside the Linux OS.
‚û§ Docker container will provide us an environment where we can run our app code it will also provide us all the softwares that are required to run that application this container will run inside linux system but for this container to run inside the linux OS the Docker engine will act as a bridge.

########################
‚ùÑÔ∏è Docker Architecture 
########################
‚û§ The architecture of docker consists of 4 major files : 
üëâ Docker file: Here we will provide instructions to create docker image 
‚û§ Here we will write the depedencies that we need to download + app code jar 
‚û§ We write docker file inside the root directory of spring boot app .

üëâ Docker image: Application package with dependencies of it 
‚û§ Will consist of all the softwares and the app code that we need to run.

üëâ Docker registry: Its a hub to store docker images
‚û§ Here we store the docker image just like maven has a library of dependencies we have docker registry .

üëâ Docker Container: Isolated environment to run docker image
‚û§ We will pull the image from the docker hub and then we will create docker container to run this container we require docker engine so that our docker containers can run easily on the linux server.

‚û§ Dockers are best suitable to run on linux 

#######################
‚ùÑÔ∏è Installing Docker 
######################
‚û§ Open aws and there create an ec2 instance 
‚û§ Connect to the ec2 instance and then install docker in your linux vm 
‚û§ Use the commands given below this will install the docker in your linux OS 

sudo yum update -y 
sudo yum install docker -y
sudo service docker start
sudo usermod -aG docker ec2-user
exit

‚û§ After installation is completed again connect to your ec2 instance and check if docker is installed or not run
docker -v 

docker pull hello-world
// This command is used to pull the image from the docker hub here we are pulling an image named hello-world from docker hub

‚û§ docker images : this command is used to give all the images that are present in your local machine 

‚û§ docker ps : This command will show the container that is currently executing / running.
docker ps -a : this will show us the container that got executed and in stopped status.

‚û§ docker run image-name : this command is used to run the docker image

‚û§ docker system prune -a : In order to remove the containers that are present in stopped status we use this command.

‚û§ docker stop container-id : This will stop the container .

###################################################################
‚ùÑÔ∏è How to create docker image and run that to access from browser 
###################################################################
‚û§ When we run our docker image from the docker hub using this command 
docker run image-name 
‚û§ This command when executed we wont be access our container in browser because it requires port mapping.
‚û§ As the container is running inside linux VM . We will have to map linux vm (host port) to container(Container port) this is called as port mapping . To do this perform the following: 

docker run -p host-port:container-port [image name] 
// This will map the container port number to our host port number (VM port number)

Example: docker run -p 9090:9090 [image-name]
-> Also run the container in the background 
‚úîÔ∏è Now you can access the application using this url http://public-ip:host-port(linux VM) 

üëâ Note: Dont forget to enable the inbound rule in security group custom IP --> IPV4 anywhere with host port number.
‚û§ If you run multiple containers in same linux vm then host port number should be different for every container.

‚û§ If you want to the the process in the background means if you close the git bash then also it will work then use this command:
docker run -p -d 9091:9090 image-name
// This will run our container in the background we can perform other task on the same git bash and our container will still be running on the background.
‚û§ To stop the container do docker stop container-id // this command will stop the container.

üåü What are the advantages of images  
**************************************
‚û§ Let us suppose that we want to install jenkins in our vm to automate the deployment process so one way to do it is without using images manually installing everything other way is using the image to download/install jenkins 

‚ú® Without image 
==================
‚òÉÔ∏è If Docker not used then we have to do the following to install jekins in linux vm

Step - 1 : Create Linux VM with Ubuntu, use t2.micro as jekins is heavy software & requires good configuration server

Create Ubuntu VM using AWS EC2 (t2.medium)
Enable 8080 Port Number in Security Group Inbound Rules
Connect to VM using ssh cleint

Step-2 : Install Jdk as jekins is java application and requires jdk to run jekins

sudo apt update
sudo apt install fontconfig openjdk-17-jre
java -version

Step-3 : Install Jenkins
sudo wget -O /usr/share/keyrings/jenkins-keyring.asc \
  https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key
echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \
  https://pkg.jenkins.io/debian-stable binary/ | sudo tee \
  /etc/apt/sources.list.d/jenkins.list > /dev/null
sudo apt-get update
sudo apt-get install jenkins

Step-4 : Start Jenkins application using the commands given below
sudo systemctl enable jenkins
sudo systemctl start jenkins

Step-5 : Verify Jenkins
sudo systemctl status jenkins

Step-6 : Open jenkins server in browser using VM public ip. Jekins runs on port 8080 by default
http://public-ip-address:8080/

Step-7 : Copy jenkins admin pwd
sudo cat /var/lib/jenkins/secrets/initialAdminPassword

Step-8 : Create Admin Account & Install Required Plugins in Jenkins to start your CI/CD pipeline learning journey

‚ú® Using docker image 
=======================
‚û§ Install jekins using docker image name - docker run -d -p 8080:8080 jenkins/jenkins

Note Enable Inbound rule in security group custom ip 8080 IPv4 anywhere

‚û§ Docker image will simplify  our journey to get required softwares in server through sinlge line

‚û§ Example download Sonarqube using docker image. If not use linux command to do the same.

docker run -d --name sonarqube -p 9000:9000 -p 9092:9092 sonarqube:lts-community

‚û§ Example download nexus using docker image, If not use linux command to do the same.

docker run -d -p 8081:8081 --name nexus sonatype/nexus3

##################################
‚ùÑÔ∏è How to create a Docker file? 
#################################
‚û§ In order to build a docker file as a developer you should know when to use the following keywords.Dockerfile instructions (FROM, CMD, ADD, etc.) are case-sensitive and must be written in uppercase.

üåü FROM 
*********
‚û§ The FROM instruction in a Dockerfile specifies the base image for your container or it will be used to specify what softwares should be downloaded to run our app. It is always the first instruction in a Dockerfile because it defines the environment where your application will run

FROM <image>:<tag>

<image> ‚Üí Name of the base image (e.g., ubuntu, node, python)
<tag> ‚Üí (Optional) Specifies the image version

‚û§ Whatever softwares are required for our app code to run we will write them into our docker file like this 
Eg: FROM openjdk:21
FROM mysql:8.0 

üåü MAINTAINER 
***************
‚û§ This instruction in a docker file was used to specify the name and email address of the person or organization responsible for maintaining the docker image . However as of docker version 1.13 the MAINTAINER instruction is deprecated in favour of using the LABEL instruction to provide metadata about the image.

üåü RUN 
*********
‚û§ This instruction is used to execute commands inside the docker container during the image build process . It helps you install packages set up confiurations or perform other tasks that need to happen before the image is finalized.
‚û§ The RUN instruction in a Dockerfile is used to execute commands during the image build process. 

Example :

RUN 'git clone <repo-url>'

RUN 'mvn clean package'

Note: If you specify multiple RUN instructions in Dockerfile, then those will execute in sequential manner.

üåü CMD 
********
‚û§ This instruction will specify the default commands that will be executed when a container is started from the image it defines the executable that should be run inside the container when you run docker run without specifying a command.
‚û§ This instruction specifies the default command that runs when the container starts.

CMD "java -jar myapp.jar"

Note: when we write multiple CMD instructions in dockerfile, docker will execute only last CMD instruction only.

üëâ To create a docker file 
++++++++++++++++++++++++++++
‚û§ Step 1: vi DockerFile  
FROM openjdk:17 
// use this FROM eclipse-temurin:17-jdk the openjdk is deprecated.
MAINTAINER Pankaj
RUN echo 'run-1'
RUN echo 'run-2'
CMD echo 'cmd-1'
CMD echo 'cmd-2'

‚û§ Step 2: Create docker image using the command
-> docker build -t pankajsiracademy/image1 .

=> We have used dot (.) in above command to mention that dockerfile is present in same working directory

‚û§ Step 3:  To check image created use the command 
-> docker image

‚û§ Step 4:  to delete the image
--> docker rmi image-id

‚û§ Step 5:  You can again create the image
--> -> docker build -t pankajsiracademy/image1 .

‚û§ Step 5: You can again create the image
--> -> docker build -t pankajsiracademy/image1 .

‚û§ Step 6: Run your docker image
--> docker run [image-id]

Note: 
1. Only last CMD instruction will run
2. docker run [image-id] echo 'hello world', you will notice now hello world will execute and not the last CMD of docker file

To over come the above said instruction we can use ENTRYPOINT 

üåü ENTRYPOINT
**************
‚û§ Alternative command for CMD but the advantage is we cant override this command 

Ex1: CMD "java -jar app.jar"

Ex2: ENTRYPOINT ["java", "-jar", "app.jar"]

üåü Copy 
*********
‚û§ COPY instruction will copy the files from the source to destination 
‚û§ It is used to copy application code from host machine to container machine.
‚û§ Here source means "HOST Machine" and Destination means "Container machine"
Ex: COPY target/your-app.jar  /usr/app/

üåü ADD 
*******
‚û§ ADD instruction will copy the files from source to destination same as COPY but in addition it can extract your compressed tar file 
‚û§ Here source can be host machine 
‚û§ ADD cannot download from HTTP/S3 URLs‚Äîthis is a misconception. (Be carefull in interviews)
Example:
ADD target/app.jar  /usr/app/

ADD <http-url>  /usr/app/ (Wrong) 

üåü WORKDIR 
************
‚û§ The WORKDIR instruction sets the working directory (Like cd command )
‚û§ If the directory does not exist, Docker will automatically create it

Example: WORKDIR /path/to/directory

COPY target/your-app.jar   /usr/app/
WORKDIR /usr/app/
CMD "java -jar your-app.jar"

üåü EXPOSE 
***********
‚û§ This command is used to specify application is running on which port number. Using this you cant change the port number of application. You are just mentioning that our application is running on the port number 9090
‚û§ If our application is running on port number 8081 you are mentioning expose 9090 then it is wrong
‚û§ It is optional to use

Example : EXPOSE 9090